# Онлайн-магазин электроники (Вариант 3)

## Описание проекта
Данный проект — это RESTful API для онлайн-магазина электроники. Система реализует каталог товаров, оформление заказов, отзывы и их модерацию. Поддерживаются различные роли пользователей с разграничением прав доступа.

## Функционал
- Просмотр, фильтрация и сортировка товаров с пагинацией
- Оформление и просмотр заказов
- Оставление и модерация отзывов
- CRUD для товаров и заказов (для менеджеров и админов)
- JWT-аутентификация и разграничение прав

## Используемые технологии
- Python
- FastAPI
- SQLAlchemy
- Pydantic
- SQLite (по умолчанию)
- JWT (pyjwt)
- Passlib (bcrypt)

## Инструкция по запуску
1. Клонируйте репозиторий:
   ```sh
   git clone https://github.com/vredinn/electronic_store.git
   cd electronic_store
   ```
2. Установите зависимости:
   ```sh
   pip install -r requirements.txt
   ```
3. Создайте и настройте файл `.env` на основе `.env.example`.

4. Инициализируйте базу данных и наполните тестовыми данными:
   ```sh
   python seed.py
   ```
5. Запустите сервер:
   ```sh
   fastapi run main.py --reload
   ```
6. Откройте документацию API: [http://localhost:8000/docs](http://localhost:8000/docs)

## Описание API
- Методология: RESTful
- Формат передачи данных: JSON (запросы и ответы)
- Документация Swagger: `/docs`
- Примеры ключевых эндпоинтов:
  - Получить товары: `GET /products?page=1&limit=10&category=Смартфоны&min_price=10000`
  - Получить заказ: `GET /api/orders/{order_id}`
  - Добавить отзыв: `POST /api/reviews/products/{product_id}`
  - Модерировать отзыв: `PATCH /api/reviews/{review_id}/status`

## Валидация ключевых эндпоинтов

### Общая информация
- Все поля проходят валидацию через Pydantic (тип, диапазон, обязательность)
- При ошибке валидации возвращается HTTP 422 с описанием
- Все защищённые эндпоинты проверяют JWT-токен (HTTP 401 при отсутствии)
- Проверка прав доступа для специальных операций (HTTP 403 при недостатке прав)

### Валидация товаров (/api/products)
**Параметры фильтрации:**
- `page`: целое число ≥ 1
- `limit`: целое число 1-100
- `category`: только существующие категории из базы данных
- `min_price`, `max_price`: числа ≥ 0 (min_price ≤ max_price)
- `in_stock`: булево значение
- `sort_by`: допустимые значения [name, price, rating]
- `sort_order`: допустимые значения [asc, desc]

### Валидация заказов (/api/orders)
- Проверка существования пользователя и товаров
- Количество товаров должно быть положительным
- Проверка корректности цен и итоговой суммы
- Доступ только для владельца заказа или администратора

### Валидация отзывов (/api/reviews)
- `rating`: целое число от 1 до 5
- `text`: строка от 10 до 1000 символов
- Только автор может редактировать свой отзыв
- Только менеджер/админ может менять статус отзыва
- Только одобренные отзывы влияют на рейтинг товара

### Пример ошибки валидации
```json
{
  "detail": [
    {
      "type": "greater_than",
      "loc": [
        "body",
        "price"
      ],
      "msg": "Input should be greater than 0",
      "input": 0,
      "ctx": {
        "gt": 0
      }
    }
  ]
}
```

## Роли пользователей и права
- **Покупатель**: просмотр товаров, оформление заказов, добавление отзывов
- **Менеджер**: управление товарами и заказами, модерация отзывов
- **Админ**: полный доступ ко всем функциям и данным
- Для доступа к защищённым эндпоинтам требуется JWT-токен

## Модерация отзывов 
- Менеджер или админ может менять статус отзыва (`/api/reviews/{review_id}/status`)
- Только одобренные отзывы используются в рейтинге товара

## Контакты
- Автор: Дмитриев Виктор Андреевич, студент группы Т-233902у-НТ НТИ (филал) УрФУ
- Email: fox3un@mail.ru
